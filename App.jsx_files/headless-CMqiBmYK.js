import{s as m}from"./semver-Zyv2pDaP.js";const v=new TextEncoder,w="_stackblitz_app_id_",E=1;function y(e,n=!1){const t=new AbortController;return{promise:A(e,n,t.signal),unsubscribe:()=>t.abort()}}async function A(e,n,t){const r=await S(e,n),s=`${O(e.slug).substring(0,n?10:30)}-${r}`;return t.aborted?new Promise(()=>{}):await _(s,t)}async function S(e,n){const{slug:t,application:r,...s}=e,o=Object.entries(s);o.sort(([u],[l])=>u===l?0:u<l?-1:1),typeof location<"u"&&o.unshift(["d",location.origin]),o.unshift(["a",r]),o.unshift(["s",t]),o.unshift(["v",String(E)]);const a=v.encode(JSON.stringify(o)),i=await I(a),c=x(i[0],i[1],i[2],i[3]);return n?c:c.slice(0,4)}function _(e,n){const t=D(e);return t??new Promise(r=>{b(`app-id-lock/${e}`,n,s=>{if(n.aborted)return;const o=s?e:N(e);o!==e&&P(e,o),r(o)})})}function b(e,n,t){const r=globalThis.navigator?.locks;if(r==null){t(!1);return}r.request(e,{ifAvailable:!0},s=>{const o=s!=null;if(t(o),!(!o&&n.aborted))return new Promise(a=>{n.addEventListener("abort",()=>a())})}).catch(()=>{t(!1)})}async function I(e){try{return await T(e)}catch{}return $(e)}async function T(e){const n=await globalThis.crypto.subtle.digest("SHA-1",e);return new Uint8Array(n)}function $(e){let n=5381;const t=4294967295;for(const s of e)n=(n<<5)+n+s&t;const r=new Uint8Array(4);return new DataView(r.buffer).setUint32(0,n),r}function x(e,n,t,r){const s=e>>3,o=(e&7)<<2|(n&192)>>6,a=n>>1&31,i=n%2<<4|(t&240)>>4,c=(t&15)<<1|(r&128)>>7,u=r>>2&31;return[s,o,a,i,c,u].map(l=>L(l)).join("")}function L(e){return e<26?String.fromCharCode(e+97):String.fromCharCode(e-26+48)}function O(e){return e.replace(/[^a-zA-Z0-9]/g,"")}function P(e,n){try{sessionStorage.setItem(`${w}/${e}`,n)}catch{}}function D(e){try{return sessionStorage.getItem(`${w}/${e}`)}catch{return null}}function N(e){return`${e}-${Math.random().toString(36).slice(2,10)}`}const R=1;function U(e){e.addLazyFileHandler({type:R},async(n,t,r)=>{if(r==null)return console.error(`Unexpected missing metadata for "${n}" request`),new ArrayBuffer(0);const s=r.lastIndexOf("@");if(s===-1)return console.error(`Malformed metadata for "${n}": "${r}"`),new ArrayBuffer(0);const o=r.slice(0,s),a=n.slice(n.lastIndexOf("node_modules")+13+o.length),i=`${e.runtimeInfo.turboURL}/f`;return(await fetch(`${i}/${r}${a}`)).arrayBuffer()})}function M(e,n,t){e.addLazyFileHandler({pattern:/usr\/local\/lib\/node_modules\/(?:pnpm|yarn)/},async r=>{let s=n.baseUrl?n.baseUrl:"",o=!0;if(r.includes("yarn.js"))s+="/yarn_index";else{const c=await C(e,t)??e.runtimeInfo.packageManagers.pnpm.at(-1).index;o=!1,s+=`/${c}`}t.environment!=="DEV_STANDALONE"&&t.version&&o&&(s+=`.${t.version}`);const i=await(await fetch(s,{credentials:"same-origin",mode:"cors"})).arrayBuffer();await e.loadFiles(new Uint8Array(i))})}let g=null;async function C(e,n){return g==null&&(g=k(e,n).catch(t=>{console.log(t)})),g}async function k(e,n){const{project:t,semver:r}=n;if(t==null||r==null)return;const s=await t.home,o=await e.readFile(s.replace(/\/$/,"")+"/package.json",void 0,"utf8"),a=JSON.parse(o),i=a.packageManager?.match(/^pnpm@(.*)$/)?.[1],c=a?.engines?.pnpm,u=i??c;if(u==null)return;const l=[...e.runtimeInfo.packageManagers.pnpm],f=(d,p)=>r.satisfies(d,p)||r.ltr(d,p);for(const{version:d,index:p}of l.reverse())if(f(d,u))return p}const F={NEXT_TELEMETRY_DISABLED:"1",ASTRO_TELEMETRY_DISABLED:"1",__NEXT_DISABLE_MEMORY_WATCHER:"1",NG_CLI_ANALYTICS:"false"},V={...F,EDITOR:"code"},B=async()=>{const e=h();return e??(await new Promise(n=>{window.addEventListener("load",()=>n())}),h())},h=()=>JSON.parse(document.querySelector("#webcontainer-context")?.textContent??"null");async function H(){const e=await B(),n=window.WebContainer,t=window.WebContainerAPIServer,s=new URL(location.href).searchParams.get("version")??void 0,o="/api/tokens/embedder/"+e.embedderId;setInterval(()=>fetch(o),e.refreshInterval*1e3),new t({defaultEnv:V,endpoint:window.parent,origin:e.embedder,version:s,async factory({webcontainerOptions:i,ready:c}){const u=await y({slug:e.embedderId,application:"headless"},e.shortAppId).promise,l=new n({...e.options,...i,systemBinaries:{git:!1},initOptions:{...e.options.initOptions,appId:u,isolationPolicy:e.options.initOptions.isolationPolicy??void 0},onError(f){}});return M(l,e.options,{version:e.options.initOptions.version,project:{home:c.then(({cwd:f})=>f)},semver:{satisfies:m.satisfies,ltr:m.ltr}}),U(l),{instance:l,appId:u,authenticationRequired:e.authenticationRequired}}}).listen()}const j=window.parent!==window;j&&H();
